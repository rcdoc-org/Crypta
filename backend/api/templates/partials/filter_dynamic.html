{% load filter_extras %}

<ul class="list-unstyled">
    {% for group in filter_tree %}
      <li class="mb-3">
        <h6>{{ group.display|capfirst }}</h6>
        <ul class="ps-3">
          {% for opt in group.options %}
            <li>
              <div class="form-check">
                <!-- Commenting out to test a new solution
                <input class="form-check-input filter-checkbox"
                       type="checkbox"
                       id="filter_{{ group.field }}_{{ opt.value }}"
                       value="{{ group.field }}:{{ opt.value }}"
                       {% if applied|get_item:group.field == opt.value %}checked{% endif %}>
                       !-->
                <input class="form-check-input filter-checkbox"
                  type="checkbox"
                  id="filter_{{ group.field }}_{{ opt.value }}"
                  value="{{ group.field }}:{{ opt.value }}"
                  data-display="{{ group.display|escapejs }}"
                  {% if applied|get_item:group.field and opt.value in applied|get_item:group.field %}checked{% endif %}
                />
                <label class="form-check-label"
                for="filter_{{ group.field }}_{{ opt.value }}"
                >
                  {{ opt.label }} <span class="text-muted">({{ opt.count }})</span>
                </label>
              </div>
            </li>
          {% endfor %}
        </ul>
      </li>
    {% endfor %}
  </ul>